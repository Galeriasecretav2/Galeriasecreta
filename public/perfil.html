<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Perfil do Usuário</title>
</head>
<body>
  <h2>Perfil</h2>
  <div id="perfil-container">Carregando...</div>
  <button id="logout">Sair</button>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js'

    const supabase = createClient(
      'https://mdjhttcdnqmkzzyebrts.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1kamh0dGNkbnFta3p6eWVicnRzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MzYwOTEyMSwiZXhwIjoyMDY5MTg1MTIxfQ.2E62b6e4O3shRIBTiYL4UVaHS_O4ly9w5A6dZT6Q8Vs'
    )

    const {
      data: { user }
    } = await supabase.auth.getUser()

    if (!user) {
      alert('Você precisa estar logado para ver esta página.')
      window.location.href = 'login.html'
    } else {
      const { data, error } = await supabase.from('perfis').select('*').eq('id', user.id).single()
      if (error) {
        document.getElementById('perfil-container').innerText = 'Erro ao carregar perfil.'
      } else {
        document.getElementById('perfil-container').innerHTML = `
          <p><strong>Nome:</strong> ${data.nome}</p>
          <p><strong>Idade:</strong> ${data.idade}</p>
          <p><strong>Província:</strong> ${data.provincia}</p>
          <p><strong>Email:</strong> ${user.email}</p>
        `
      }
    }

    document.getElementById('logout').addEventListener('click', async () => {
      await supabase.auth.signOut()
      localStorage.removeItem('session')
      window.location.href = 'login.html'
    })
  </script>
</body>
</html>
